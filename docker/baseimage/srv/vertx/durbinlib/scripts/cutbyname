#!/usr/bin/env groovy

import durbin.util.*

err = System.err

if (args.size() < 2){
	err.println """
	cutbyname fileName columnName {columnName2,columnName3...}
	
	Cuts one or more columns out of a table file.  For more complex queries see csvsql.
	
	e.g. 
	
	cutbyname BRCA.clin days_to_death.
	
	cutbyname BRCA.clin patient days_to_death
	"""
	System.exit(0)
}

fileName = args[0]
cutNames = args[1..-1]
sep = FileUtils.determineSeparator(fileName) as String

// If it's a csv, go ahead and handle quoted comma lists too...
if (sep ==","){
	sep = /,(?=([^\"]|\"[^\"]*\")*$)/
}


new File(fileName).withReader{r->
	headerStr = r.readLine()
	headings = headerStr.split(sep)
	name2IdxMap = [:]
	headings.eachWithIndex{h,i->name2IdxMap[h] = i}
	
	headingElements = []
	indices = []
	cutNames.each{cutName->
		cutIdx = name2IdxMap[cutName]
		indices<<cutIdx
		headingElements << headings[cutIdx]
	}
	println headingElements.join(sep)
					
	r.splitEachLine(sep){fields->
		allfields = []
		indices.each{i->
			allfields<<fields[i]
		}
		println allfields.join(sep)
	}	
}
